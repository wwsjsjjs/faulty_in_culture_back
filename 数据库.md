# 数据库结构总结

## 1. users（用户表）

用户信息表，存储所有用户的基本信息和账号数据。

| 列名           | 类型         | 约束           | 说明         |
| -------------- | ------------ | -------------- | ------------ |
| id             | INT          | PRIMARY KEY, AUTO_INCREMENT | 用户ID       |
| username       | VARCHAR(255) | UNIQUE, NOT NULL | 用户名       |
| password       | VARCHAR(255) | NOT NULL       | 密码（加密，建议加密存储） |
| created_at     | DATETIME     | NOT NULL, DEFAULT CURRENT_TIMESTAMP | 创建时间     |
| last_login_at  | DATETIME     | NOT NULL, DEFAULT CURRENT_TIMESTAMP | 上次登录时间 |
| score          | INT          | NOT NULL, DEFAULT 0, CHECK (score >= 0) | 得分（用于排名，非负） |
| score_update_at | DATETIME | NOT NULL, DEFAULT CURRENT_TIMESTAMP     | 分数最后更新时间 |

## 2. save_games（存档表）

用户游戏存档表，每个用户可以保存6个存档。

| 列名        | 类型     | 约束                              | 说明         |
| ----------- | -------- | --------------------------------- | ------------ |
| user_id     | INT      | PRIMARY KEY, FOREIGN KEY → users.id ON DELETE CASCADE | 用户ID（用户删除时存档自动删除） |
| slot_number | INT      | PRIMARY KEY, CHECK (slot_number BETWEEN 1 AND 6), NOT NULL | 存档槽编号(1-6) |
| game_data   | JSON/TEXT | NULL | 游戏存档数据（JSON 格式，可为 null） |
| saved_at    | DATETIME | NOT NULL, DEFAULT CURRENT_TIMESTAMP | 保存时间     |

## 3. messages（消息历史记录表）

用户消息历史表，记录与AI或系统的消息交互。

| 列名        | 类型     | 约束                           | 说明         |
| ----------- | -------- | ------------------------------ | ------------ |
| id          | INT      | PRIMARY KEY, AUTO_INCREMENT    | 消息ID       |
| user_id     | INT      | FOREIGN KEY → users.id ON DELETE CASCADE | 用户ID（用户删除时消息自动删除） |
| message     | TEXT     | NOT NULL                       | 消息内容     |
| status      | INT      | NOT NULL, DEFAULT 0, CHECK (status IN (0,1,2)) | 消息状态（0=待处理, 1=已处理, 2=异常） |
| created_at  | DATETIME | NOT NULL, DEFAULT CURRENT_TIMESTAMP | 创建时间 |

## 4. chat_sessions（聊天会话表）

聊天会话表，记录用户开启的聊天会话。

| 列名        | 类型     | 约束                     | 说明         |
| ----------- | -------- | ------------------------ | ------------ |
| id          | INT      | PRIMARY KEY, AUTO_INCREMENT | 会话ID       |
| user_id     | INT      | FOREIGN KEY → users.id ON DELETE CASCADE | 用户ID（用户删除时会话自动删除） |
| title       | VARCHAR(255) | NOT NULL              | 会话标题     |
| type        | INT      | NOT NULL, DEFAULT 1, CHECK (type IN (1,2)) | 会话类型（1=用户，2=npc） |
| created_at  | DATETIME | NOT NULL, DEFAULT CURRENT_TIMESTAMP | 创建时间 |

## 5. chat_messages（聊天消息表）

聊天消息表，存储每个会话内的具体消息。

| 列名        | 类型     | 约束                        | 说明         |
| ----------- | -------- | --------------------------- | ------------ |
| id          | INT      | PRIMARY KEY, AUTO_INCREMENT | 消息ID       |
| session_id  | INT      | FOREIGN KEY → chat_sessions.id ON DELETE CASCADE | 会话ID（会话删除时消息自动删除） |
| role     | INT      | NOT NULL, DEFAULT 1, CHECK (role IN (1,2)) | 角色（1=用户，2=npc） |
| content     | TEXT     | NOT NULL                    | 消息内容     |
| created_at  | DATETIME | NOT NULL, DEFAULT CURRENT_TIMESTAMP | 创建时间 |

